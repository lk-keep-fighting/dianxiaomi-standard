# AI分类审核系统

## 功能概述

当AI检测到商品分类不合理时，系统会自动将这些商品记录到CSV文件中，供后续人工处理。

## 工作流程

### 1. 自动检测与记录

程序运行时会：
- ✅ 使用AI验证每个商品的分类合理性
- 📝 将不合理的分类自动记录到CSV文件
- 🔗 保存商品链接、标题、当前分类、AI分析等信息
- 💡 记录AI建议的更合适分类

### 2. CSV文件格式

生成的文件名格式：`unreasonable_categories_YYYYMMDD.csv`

包含以下列：
- **时间**: 记录时间戳
- **商品链接**: Amazon产品链接
- **商品标题**: 产品标题（截取前100字符）
- **当前分类**: 页面显示的当前分类
- **AI分析原因**: AI给出的分析理由（截取前200字符）
- **AI建议分类**: AI推荐的更合适分类
- **处理状态**: 人工处理状态标记

### 3. 处理状态说明

| 状态 | 说明 |
|------|------|
| 待处理 | 新记录，未经人工审核 |
| 已采用AI建议 | 人工确认采用AI建议分类 |
| 保持原分类 | 人工确认保持当前分类 |
| 需要人工修改 | 需要人工设定其他分类 |
| 已跳过 | 暂时跳过处理 |

## 使用说明

### 自动记录功能

运行主程序时，系统会自动：

```bash
python src/main_refactored_dianxiaomi.py
```

程序输出示例：
```
🤖 正在进行AI分类验证...
🎯 AI验证结果: ⚠️ 分类可能不准确
💡 AI建议分类: 储物柜(Storage Cabinets)
📝 已记录待处理商品到文件: unreasonable_categories_20241201.csv
```

### 人工审核工具

使用专门的审核工具处理记录的商品：

```bash
python review_categories.py
```

审核工具功能：
- 📋 列出所有待审核文件
- 📊 显示统计信息
- 🔍 逐个商品审核
- ✅ 更新处理状态
- 💾 保存审核结果

## 审核工具使用流程

### 1. 启动审核工具

```bash
python review_categories.py
```

### 2. 选择文件

```
📁 发现以下审核文件:
  1. unreasonable_categories_20241201.csv (2048 bytes)
  2. unreasonable_categories_20241130.csv (1024 bytes)

请选择操作: 1
```

### 3. 查看统计

```
📊 文件统计: unreasonable_categories_20241201.csv
========================================
📦 总商品数: 5
   待处理: 3 个
   已采用AI建议: 1 个
   保持原分类: 1 个
========================================
```

### 4. 开始审核

对每个商品，系统会显示：
- 商品详细信息
- AI分析结果
- 操作选项

```
📦 商品 1
============================================================
📝 标题: 实木床头柜简约现代卧室储物柜...
📂 当前分类: 床头柜(Nightstands)
🤖 AI建议: 储物柜(Storage Cabinets)
📊 AI分析: 根据产品特征，更适合归类为储物柜...

🤔 操作选项:
  [A] 接受AI建议并标记为'已采用AI建议'
  [R] 拒绝AI建议并标记为'保持原分类'
  [M] 标记为'需要人工修改'
  [S] 跳过此商品
```

## 文件管理

### 文件位置
- 📁 CSV文件保存在程序根目录
- 📅 按日期自动分组（每天一个文件）
- 🔄 同一天的记录追加到同一文件

### 文件清理
建议定期清理已处理完成的CSV文件：
```bash
# 备份已完成的审核文件
mkdir processed_reviews
mv unreasonable_categories_*.csv processed_reviews/
```

## 高级功能

### 批量状态更新

可以直接编辑CSV文件进行批量状态更新：
1. 用Excel或类似工具打开CSV文件
2. 修改"处理状态"列
3. 保存文件

### 统计分析

查看所有文件的综合统计：
```bash
python review_categories.py
# 选择 [S] 显示统计
```

### 数据导出

处理完成的数据可以：
- 📊 导入其他分析工具
- 📈 生成分类准确性报告
- 🔄 用于改进AI模型

## 最佳实践

### 1. 及时审核
- 🕐 建议每天审核一次
- 📊 避免积累过多待处理商品

### 2. 状态规范
- ✅ 统一使用规定的处理状态
- 📝 必要时可添加备注

### 3. 备份保护
- 💾 定期备份重要的审核文件
- 🔒 避免误删除历史数据

### 4. 团队协作
- 👥 多人审核时避免同时编辑同一文件
- 🔄 建立审核轮班制度

## 故障排除

### CSV文件损坏
```bash
# 检查文件编码
file unreasonable_categories_*.csv

# 修复编码问题
iconv -f utf-8 -t utf-8-sig file.csv > fixed_file.csv
```

### 权限问题
```bash
# 确保文件可写
chmod 644 unreasonable_categories_*.csv
```

### 数据恢复
- 📁 检查系统回收站
- 💾 从备份恢复
- 🔄 重新运行主程序生成新记录

这个系统确保了AI检测到的分类问题不会丢失，同时提供了便捷的人工审核流程。